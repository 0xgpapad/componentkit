<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.55">
<link rel="search" type="application/opensearchdescription+xml" title="ComponentKit" href="/opensearch.xml"><title data-react-helmet="true">Basics | ComponentKit</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Basics | ComponentKit"><meta data-react-helmet="true" name="description" content="In this section we will go through the steps to create a UICollectionView powered by components."><meta data-react-helmet="true" property="og:description" content="In this section we will go through the steps to create a UICollectionView powered by components."><meta data-react-helmet="true" property="og:url" content="https://componentkit.org/docs/datasource-basics"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://componentkit.org/docs/datasource-basics"><link rel="stylesheet" href="/styles.223d530e.css">
<link rel="preload" href="/styles.cd3b437a.js" as="script">
<link rel="preload" href="/runtime~main.69b714a7.js" as="script">
<link rel="preload" href="/main.b17a5110.js" as="script">
<link rel="preload" href="/1.1cd073dc.js" as="script">
<link rel="preload" href="/2.ca98ee9d.js" as="script">
<link rel="preload" href="/1be78505.7a04a194.js" as="script">
<link rel="preload" href="/57.b0ba20a7.js" as="script">
<link rel="preload" href="/20ac7829.a1bfe5fc.js" as="script">
<link rel="preload" href="/fbc537ff.3eaf3823.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ck_logo.png" alt="ComponentKit Logo"><strong class="navbar__title">ComponentKit</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/getting-started">Docs</a><a target="_blank" rel="noopener noreferrer" href="/appledoc/html/index.html" class="navbar__item navbar__link">API</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/componentkit" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ck_logo.png" alt="ComponentKit Logo"><strong class="navbar__title">ComponentKit</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="/appledoc/html/index.html" class="menu__link">API</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/componentkit" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/philosophy">Philosophy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/uses">Uses</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/component-api">Component API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/composite-components">Composite Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/views">Views</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/responder-chain">Responder Chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/actions">Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/state">State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/scopes">Scopes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/component-controllers">Component Controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/lifecycle-methods">Lifecycle Methods</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/debugging">Debugging</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Animations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations-general-principles">General Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations-initial-and-final">Initial / Final Animations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations-change">Change Animations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations-legacy-apis">Legacy APIs</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Collection Views</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/datasource-overview">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/datasource-basics">Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/datasource-changeset-api">Changeset API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/datasource-gotchas">Gotchas</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/datasource-dive-deeper">Dive Deeper</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/never-subclass-components">Never Subclass Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/avoid-overrides">Avoid Overrides</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indentation">Indentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/avoid-local-variables">Avoid Local Variables, Use Const</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/avoid-single-use-constants">Avoid Single Use Constants</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/no-underscores">No Underscores</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pass-in-actions">Pass in Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/no-side-effects">No Side Effects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pass-in-immutable-objects">Pass in Immutable Objects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/components-cant-be-delegates">Components Can&#x27;t Be Delegates Directly</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/avoid-excessive-branching">Avoid Excessive Branching</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/check-for-nil">Check for Nil</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/avoid-push-back">Avoid push_back</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/under-300-lines">Under 300 Lines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/avoid-width-100-percent">Avoid Width 100%</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/use-designated-initializer-style">Use Designated Initializer Style</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/break-out-composites">Break Out Composite Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/keep-controller-in-component">Keep Controller in Component</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Infrastructure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/component-hosting-view">Component Hosting View</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/why-cpp">Why C++</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/advanced-views">Advanced Views</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/component-context">Component Context</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Basics</h1></header><div class="markdown"><p>In this section we will go through the steps to create a <code>UICollectionView</code> powered by components.</p><p>We will use a simple setup with a <code>UIViewController</code> using a <code>UICollectionView</code> that uses a <code>UICollectionViewFlowLayout</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="setup"></a>Setup<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setup" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="component-provider"></a>Component Provider<a aria-hidden="true" tabindex="-1" class="hash-link" href="#component-provider" title="Direct link to heading">#</a></h4><p>The <code>CKCollectionViewDataSource</code> is responsible for transforming each model into a component.</p><p>This transformation will be defined as a method on a class conforming to <code>CKComponentProvider</code>. This class will then be passed to the <code>CKCollectionViewDataSource</code> as the component provider and the datasource will call the provider every time it needs to generate a component for a model.</p><p>Let&#x27;s make our UIViewController be the component provider here.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-objectivec codeBlock_1wn8" style="color:#393A34"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">@interface</span><span class="token plain"> MyController </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CKComponentProvider</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">@end</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">@implementation</span><span class="token plain"> MyController</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CKComponent </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">componentForModel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyModel</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">model context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyContext</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">context </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MyComponent newWithModel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">model context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span></div></pre></div><div class="note-important"><p>This class method has to be pure and thread safe.</p></div><ul><li><strong>Why use a class Method and not a block?</strong> The model to component transform should not rely on mutable state. Blocks make it very easy to capture mutable state that could introduce side effects in the system. Using a class method allows to better enforce the constraint of immutability from an API standpoint.</li><li><strong>What is this context ?</strong> The context is an arbitrary immutable object, that is passed to this method by the <code>CKCollectionViewDataSource</code>. Typically, the context can be used to pass into your component tree:<ul><li>immutable contextual informations such as the type of device.</li><li>external dependencies such as an image downloader.</li></ul></li></ul><div class="note-important"><p>Don&#x27;t access global state inside a Component. Use the context to pass this information instead.</p></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="create-a-ckcollectionviewdatasource"></a>Create a <code>CKCollectionViewDataSource</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-ckcollectionviewdatasource" title="Direct link to heading">#</a></h4><p>Ok, so now we have our view controller as the component provider, let&#x27;s create our <code>CKCollectionViewDataSource</code> and attach the collection view to it.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-objectivec codeBlock_1wn8" style="color:#393A34"><div class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">viewDidLoad </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">super</span><span class="token plain"> viewDidLoad</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Range provider</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">_sizeRangeProvider </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CKComponentFlexibleSizeRangeProvider providerWithFlexibility</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">CKComponentSizeRangeFlexibleHeight</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> CKSizeRange sizeRange </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_sizeRangeProvider sizeRangeForBoundingSize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">collectionView</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bounds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Data source configuration</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">CKDataSourceConfiguration </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">configuration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CKDataSourceConfiguration alloc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> initWithComponentProviderFunc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ComponentProvider context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">context sizeRange</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sizeRange</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Data source                       </span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">_dataSource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CKCollectionViewDataSource alloc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> initWithCollectionView</span><span class="token punctuation" style="color:#393A34">:</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">collectionView supplementaryViewDataSource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">nil configuration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">configuration</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span></div></pre></div><p>Note that we pass the context in the initializer. It is the same context that will get passed into <code>+ (CKComponent *)componentForModel:context:</code> every time a component needs to be computed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="addmodify-content-in-the-collection-view"></a>Add/Modify content in the collection view<a aria-hidden="true" tabindex="-1" class="hash-link" href="#addmodify-content-in-the-collection-view" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="changeset-api"></a>Changeset API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#changeset-api" title="Direct link to heading">#</a></h4><p>Using <code>CKCollectionViewDataSource</code> changes are never applied directly to the collection. Instead, commands are sent to the datasource and from those commands will be used to compute the components and apply the corresponding changes to the collection view.</p><p>Let&#x27;s add a section at index 0 with two items at indexes 0 and 1.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-objectivec codeBlock_1wn8" style="color:#393A34"><div class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">viewDidAppear</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BOOL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">animated </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">super</span><span class="token plain"> viewDidAppear</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">animated</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  CKDataSourceChangeset </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">initialChangeset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CKDataSourceChangesetBuilder dataSourceChangeset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    withInsertedSections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">NSIndexSet indexSetWithIndex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Don&#x27;t forget the insertion of section 0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      withInsertedItems</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">@</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">NSIndexPath indexPathForItem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> inSection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> firstModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">NSIndexPath indexPathForItem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> inSection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secondModel</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> build</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataSource applyChangeset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">initialChangeset mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">CKUpdateModeAsynchronous userInfo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></pre></div><p>Later on (for instance when updated data is received from the server), we can update our first item with an updated model.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-objectivec codeBlock_1wn8" style="color:#393A34"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">CKDataSourceChangeset </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">updateChangeset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CKDataSourceChangesetBuilder dataSourceChangeset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> withUpdatedItems</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">@</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">NSIndexPath indexPathForItem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> inSection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> updatedFirstModel</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> build</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataSource applyChangeset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">updateChangeset mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">CKUpdateModeAsynchronous userInfo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">nil</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span></div></pre></div><p>It is also possible to remove items and sections through this <a href="/docs/datasource-changeset-api">changeset API</a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="layout"></a>Layout<a aria-hidden="true" tabindex="-1" class="hash-link" href="#layout" title="Direct link to heading">#</a></h4><p>As you can see above a <em>constrained size</em> is passed every time a changeset is enqueued, this constrained size is used internally to layout the components and compute their final sizes which will have to be within those top-level constraints.</p><p>The form of the constrained size is: {% raw  %}<code>{{minWidth, minHeight},{maxWidth, maxHeight}}</code>{% endraw %}.</p><p>Let&#x27;s see how the computed component sizes can be used with the <code>UICollectionViewFlowLayout</code>, for the purpose of this example let&#x27;s assume that the view controller is the delegate of the flow layout.</p><p>Each item is sized so that it matches the size of its corresponding component.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-objectivec codeBlock_1wn8" style="color:#393A34"><div class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CGSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">collectionView</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UICollectionView </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">collectionView layout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UICollectionViewLayout </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">collectionViewLayout sizeForItemAtIndexPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NSIndexPath </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">indexPath </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataSource sizeForItemAtIndexPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">indexPath</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></pre></div><p>Pretty simple right ? And this logic can apply to any <code>UICollectionViewLayout</code> :</p><ul><li>The datasource computes the size of the components within the top level constraint.</li><li>Then those sizes can be used in a <code>UICollectionViewLayout</code> to size and position the corresponding items.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="handle-actions"></a>Handle actions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#handle-actions" title="Direct link to heading">#</a></h3><p>Time to interact with those items now; nothing special here the regular selection APIs can be used. Let&#x27;s say the models have a url that should be opened when the user tap on an item.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-objectivec codeBlock_1wn8" style="color:#393A34"><div class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">collectionView</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UICollectionView </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">collectionView didSelectItemAtIndexPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NSIndexPath </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">indexPath</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    MyModel </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyModel </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dataSource modelForItemAtIndexPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">indexPath</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">url </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">UIApplication sharedApplication</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> openURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">navURL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></pre></div><div class="note-important"><p>The datasource is the source of truth for the collection view, if you have to retrieve a model corresponding to an indexPath always use <code>-modelForItemAtIndexPath</code>. See this <a href="/docs/datasource-gotchas">gotcha</a> for more details.</p></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/datasource-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/datasource-changeset-api"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Changeset API »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link">Setup</a></li><li><a href="#addmodify-content-in-the-collection-view" class="table-of-contents__link">Add/Modify content in the collection view</a></li><li><a href="#handle-actions" class="table-of-contents__link">Handle actions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Facebook Open Source Logo" src="https://docusaurus.io/img/oss_logo.png"></div><div>Copyright © 2020 Facebook, Inc.</div></div></div></footer></div>
<script src="/styles.cd3b437a.js"></script>
<script src="/runtime~main.69b714a7.js"></script>
<script src="/main.b17a5110.js"></script>
<script src="/1.1cd073dc.js"></script>
<script src="/2.ca98ee9d.js"></script>
<script src="/1be78505.7a04a194.js"></script>
<script src="/57.b0ba20a7.js"></script>
<script src="/20ac7829.a1bfe5fc.js"></script>
<script src="/fbc537ff.3eaf3823.js"></script>
</body>
</html>